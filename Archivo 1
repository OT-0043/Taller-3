#include <iostream>
#include <vector>
#include <string>
#include <fstream>
#include <sstream>

using namespace std;

// Función para convertir string a int
int stringToInt(const string& str) {
    int result = 0;
    for (size_t i = 0; i < str.length(); i++) {
        char c = str[i];
        if (c >= '0' && c <= '9') {
            result = result * 10 + (c - '0');
        }
    }
    return result;
}

// Función para convertir string a double
double stringToDouble(const string& str) {
    double result = 0.0;
    double decimal = 0.0;
    bool afterDecimal = false;
    double decimalMultiplier = 0.1;
    
    for (size_t i = 0; i < str.length(); i++) {
        char c = str[i];
        if (c == '.') {
            afterDecimal = true;
        } else if (c >= '0' && c <= '9') {
            if (!afterDecimal) {
                result = result * 10 + (c - '0');
            } else {
                decimal += (c - '0') * decimalMultiplier;
                decimalMultiplier *= 0.1;
            }
        }
    }
    return result + decimal;
}

struct Producto {
    int idProducto;
    string nombre;
    string descripcion;
    double precio;
    int stock;
}; //agrego parte de la funcionalidad del codigo.

struct Usuario {
    int idUsuario;
    string nombre;
    string correoElectronico;
    string contraseña;
    string direccion;
    string metodoDePago;
};

struct Comentario {
    int idComentario;
    string producto;
    string usuario;
    string comentario;
    string fecha;
};

struct CarritoDeCompras {
    int idCarrito;
    vector<Producto> productos;
    double subtotal;
    double impuestos;
};

vector<Usuario> usuarios;
vector<Producto> productos;
vector<Comentario> comentarios;
CarritoDeCompras carrito;
Usuario usuarioActual;

void cargarUsuarios() {
    ifstream archivo("Usuarios.txt");
    string linea;
   
    // Leer todas las líneas
    while (getline(archivo, linea)) {
        stringstream ss(linea);
        string token;
        Usuario u;
       
        // Leer idUsuario
        if (getline(ss, token, ',')) {
            u.idUsuario = stringToInt(token);
        }
       
        // Leer nombre
        if (getline(ss, u.nombre, ',')) {
            // Limpiar espacios extras
            if (!u.nombre.empty() && u.nombre[0] == ' ') {
                u.nombre = u.nombre.substr(1);
            }
        }
       
        // Leer correoElectronico
        if (getline(ss, u.correoElectronico, ',')) {
            if (!u.correoElectronico.empty() && u.correoElectronico[0] == ' ') {
                u.correoElectronico = u.correoElectronico.substr(1);
            }
        }
       
        // Leer contraseña
        if (getline(ss, u.contraseña, ',')) {
            if (!u.contraseña.empty() && u.contraseña[0] == ' ') {
                u.contraseña = u.contraseña.substr(1);
            }
        }

// Leer direccion
        if (getline(ss, u.direccion, ',')) {
            if (!u.direccion.empty() && u.direccion[0] == ' ') {
                u.direccion = u.direccion.substr(1);
            }
        }
       
        // Leer metodoDePago
        if (getline(ss, u.metodoDePago)) {
            if (!u.metodoDePago.empty() && u.metodoDePago[0] == ' ') {
                u.metodoDePago = u.metodoDePago.substr(1);
            }
        }
       
        usuarios.push_back(u);
    }
    archivo.close();
}

void cargarProductos() {
    ifstream archivo("Productos.txt");
    string linea;
   
    while (getline(archivo, linea)) {
        stringstream ss(linea);
        string token;
        Producto p;
       
        // Leer idProducto
        if (getline(ss, token, ',')) {
            p.idProducto = stringToInt(token);
        }
       
        // Leer nombre
        if (getline(ss, p.nombre, ',')) {
            if (!p.nombre.empty() && p.nombre[0] == ' ') {
                p.nombre = p.nombre.substr(1);
            }
        }
       
        // Leer descripcion
        if (getline(ss, p.descripcion, ',')) {
            if (!p.descripcion.empty() && p.descripcion[0] == ' ') {
                p.descripcion = p.descripcion.substr(1);
            }
        }
       
        // Leer precio
        if (getline(ss, token, ',')) {
            p.precio = stringToDouble(token);
        }
       
        // Leer stock
        if (getline(ss, token)) {
            p.stock = stringToInt(token);
        }
       
        productos.push_back(p);
    }
    archivo.close();
}

void cargarComentarios() {
    ifstream archivo("Comentarios.txt");
    string linea;
   
    while (getline(archivo, linea)) {
        stringstream ss(linea);
        string token;
        Comentario c;
       
        // Leer idComentario
        if (getline(ss, token, ',')) {
            c.idComentario = stringToInt(token);
        }
       
        // Leer producto
        if (getline(ss, c.producto, ',')) {
            if (!c.producto.empty() && c.producto[0] == ' ') {
                c.producto = c.producto.substr(1);
            }
        }
       
